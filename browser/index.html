<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Tesseract.js Offline</title>
    <style>
      #myProgress {
        width: 100%;
        background-color: grey;
      }

      #myBar {
        width: 1%;
        height: 30px;
        background-color: green;
      }
    </style>
    <script src="../node_modules/tesseract.js/dist/tesseract.min.js"></script>
  </head>
  <body>
      <div>
        <input type="file" id="getImage" accept="image/*">
        <br>
        <img height="300" width="300" id="imagePreview" src="#" alt="preview">
        <hr>
        Receber Atualização de logs
        <div id="logs"></div>
        <div id="myProgress">
            <div id="myBar"></div>
          </div>
        <p id="resultado"></p>
      </div>
      <script>
        //https://github.com/tesseract-ocr/tesseract/wiki/ImproveQuality
          const { TesseractWorker } = Tesseract;
          const worker = new TesseractWorker({
            workerPath: '../node_modules/tesseract.js/dist/worker.min.js',
            langPath: '../lang-data',
            corePath: '../node_modules/tesseract.js-core/tesseract-core.wasm.js',
          });
          
          document.getElementById("getImage").addEventListener("change", (event) => {
            const image = event.target.files[0]
            readURL(image)
            //'../images/download.png'
            worker
            .recognize(image)
            .progress((info) => {
              document.getElementById('logs').innerText = info.status
              document.getElementById('myBar').style.width = Math.round(info.progress*100) + '%'
            })
            .then((result) => {
              document.getElementById('resultado').innerText = result.text
            });
          })

          function readURL(image) {
            let reader = new FileReader();
              
            reader.onload = function(e) {
              document.getElementById('imagePreview').setAttribute('src', e.target.result);
            }
            
            reader.readAsDataURL(image);
          }

          
        </script>
  </body>
</html>
